KISSY.add("gallery/menu-aim/1.1/index",function(e){var t=e.all,n=function(o){var r=this;r.opts=e.mix(n.defs,o),r.$wrap=t(r.opts.wrap),r.$menu=t(r.opts.menu),r.locs=[],r.rNow=null,r.tOut=null,r.init()};return n.defs={wrap:"",menu:"",rows:"",dealy:300,handler:null,tolerance:0},n.prototype.getOffset=function(){var e=this,t=e.opts,n=e.$menu,o=n.offset();e.menuOffset=o,e.upperRight={x:o.left+n.outerWidth(),y:o.top-t.tolerance},e.lowerRight={x:o.left+n.outerWidth(),y:o.top+n.outerHeight()+t.tolerance}},n.prototype.bindEvent=function(){var e=this,t=e.opts,n=e.locs,o=e.rNow,r=e.tOut,u=e.menuOffset,i=e.upperRight,l=e.lowerRight,a=null,f=function(){function e(e,t){return(t.y-e.y)/(t.x-e.x)}var r=n[n.length-1],f=n[0];if(!o||!r)return 0;if(f.x<u.left||f.x>l.x||f.y<u.top||f.y>l.y)return 0;if(a&&r.x==a.x&&r.y==a.y)return 0;var s=e(r,i),p=e(r,l),c=e(f,i),h=e(f,l);return c>s&&p>h?(a=r,t.dealy):(a=null,0)},s=function(e){o!=e&&(t.handler.enterHandler(e),o=e)},p=function(e){var t=f();t?r=setTimeout(function(){p(e)},t):s(e)},c=function(e){n.push({x:e.pageX,y:e.pageY}),n.length>3&&n.shift()},h=function(){o=null,t.handler.leaveHandler()},d=function(){r&&clearTimeout(r)},m=function(e){r&&clearTimeout(r),p(e.currentTarget)};e.$wrap.on("mousemove",c).on("mouseleave",h),e.$menu.on("mouseleave",d).delegate("mouseenter",t.rows,m)},n.prototype.init=function(){this.getOffset(),this.bindEvent()},n},{requires:["node"]});